<!DOCTYPE html>
<html lang="pt-BR">

<head>
  <meta charset="UTF-8">
  <title>Histórico de Alertas</title>
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
    }

    .tabela {
      width: 95%;
      margin: 20px auto;
      background-color: #ddd;
      border-radius: 10px;
      padding: 20px;
      box-shadow: 3px 5px 5px #333;
    }

    table {
      width: 100%;
      border-collapse: collapse;
    }

    th,
    td {
      padding: 12px;
      text-align: center;
    }

    th {
      font-size: 1.2rem;
    }

    .btn {
      cursor: pointer;
      background: none;
      border: none;
      font-size: 1.2rem;
    }

    .btn:hover {
      color: darkblue;
    }
  </style>
</head>

<body>

  <h2 style="margin-left: 20px;">Histórico de Alertas</h2>

  <div class="tabela">
    <table>
      <thead>
        <tr>
          <th>Servidor</th>
          <th>Componente</th>
          <th>Data</th>
          <th>Gravidade</th>
          <th>Status</th>
          <th>Visualizar</th>
        </tr>
      </thead>
      <tbody id="tabela-alertas">
        <!-- Conteúdo inserido via JS -->
      </tbody>
    </table>
  </div>

  <script>
    const alertas = [
      {
        id: 1,
        servidor: "SV-001",
        componente: "CPU",
        data: "05/04/2025",
        gravidade: "Grave",
        status: "Aberto"
      },
      {
        id: 2,
        servidor: "SV-002",
        componente: "Memória",
        data: "04/04/2025",
        gravidade: "Médio",
        status: "Aberto"
      }
    ]

    const tabela = document.getElementById('tabela-alertas')

    alertas.forEach(alerta => {
      const tr = document.createElement('tr')

      tr.innerHTML = `
        <td>${alerta.servidor}</td>
        <td>${alerta.componente}</td>
        <td>${alerta.data}</td>
        <td>${alerta.gravidade}</td>
        <td>${alerta.status}</td>
        <td><button class="btn" onclick="abrirModal(${alerta.id})">↦</button></td>
      `

      tabela.appendChild(tr)
    })

    function abrirModal(id) {
      const alerta = alertas.find(a => a.id === id)

      Swal.fire({
        title: `Detalhes do Alerta ${alerta.id}`,
        html: `
          <p><strong>Servidor:</strong> ${alerta.servidor}</p>
          <p><strong>Componente:</strong> ${alerta.componente}</p>
          <p><strong>Data:</strong> ${alerta.data}</p>
          <p><strong>Gravidade:</strong> ${alerta.gravidade}</p>
          <p><strong>Status:</strong> ${alerta.status}</p>
          <hr>
          <input type="text" id="observacao" class="swal2-input" placeholder="Digite uma observação">
        `,
        showCancelButton: true,
        confirmButtonText: 'Salvar Observação',
        cancelButtonText: 'Fechar',
        preConfirm: () => {
          const obs = document.getElementById('observacao').value
          if (!obs) {
            Swal.showValidationMessage('Por favor, digite uma observação.')
            return false
          }
          return { observacao: obs }
        }
      }).then((result) => {
        if (result.isConfirmed) {
          // Enviar para o backend
          fetch('https://seuservidor.com/api/observacoes', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json'
            },
            body: JSON.stringify({
              idAlerta: alerta.id,
              observacao: result.value.observacao
            })
          })
            .then(resp => {
              if (!resp.ok) throw new Error('Erro no envio')
              return resp.json()
            })
            .then(data => {
              Swal.fire('Sucesso!', 'Observação salva com sucesso!', 'success')
            })
            .catch(err => {
              Swal.fire('Erro!', 'Falha ao salvar observação.', 'error')
            })
        }
      })
    }
  </script>
</body>

</html>